<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Probar backend de Valeria</title>
  <style>
    body { font-family: system-ui, sans-serif; margin: 2rem; max-width: 720px; }
    label { display:block; margin:.5rem 0; font-weight:600; }
    textarea { width:100%; height:120px; padding:.6rem; }
    button { padding:.6rem 1rem; margin:.4rem .4rem .4rem 0; cursor:pointer; }
    pre { background:#f6f6f6; padding:1rem; border-radius:8px; white-space:pre-wrap; }
  </style>
</head>
<body>
  <h1>Probar backend de Valeria</h1>
  <p>Esta página envía tu mensaje a <code>/.netlify/functions/chat</code> y muestra la respuesta leyendo <b>reply</b> o <b>answer</b>.</p>

  <label for="msg">Mensaje para Valeria</label>
  <textarea id="msg">¿Cómo verificar 200 ppm con tiras reactivas?</textarea>
  <div>
    <button id="ping">Probar PING</button>
    <button id="send">Enviar mensaje</button>
  </div>

  <h3>Respuesta del servidor</h3>
  <pre id="out">—</pre>

  <script>
    const out = document.getElementById('out');
    const show = (x) => out.textContent = typeof x === 'string' ? x : JSON.stringify(x, null, 2);

    document.getElementById('ping').onclick = async () => {
      show('Consultando…');
      try {
        const r = await fetch('/.netlify/functions/chat?msg=!!ping');
        const j = await r.json();
        show(j.reply || j.answer || j);
      } catch (e) { show('Error: ' + e); }
    };

    document.getElementById('send').onclick = async () => {
      const message = document.getElementById('msg').value.trim();
      if (!message) { show('Escribí un mensaje.'); return; }
      show('Enviando…');
      try {
        const r = await fetch('/.netlify/functions/chat', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ message })
        });
        const j = await r.json();
        show(j.reply || j.answer || j);
      } catch (e) { show('Error: ' + e); }
    };
  </script>
</body>
</html>
