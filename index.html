<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Valeria Â· Seguridad Alimentaria</title>
  <meta name="theme-color" content="#0a2f73" />
  <link rel="icon" href="valeria-logo.png" />
  <style>/* CSS MANTENIDO SEGÃšN VALIDADO1 (omito por brevedad visual) */</style>
</head>
<body>
  <div class="header">
    <img src="valeria-logo.png" alt="Valeria perfil" class="profile-mini" />
    <div class="header-text">
      <h1>Valeria</h1>
      <p>Seguridad Alimentaria</p>
    </div>
    <button id="mode-toggle">ğŸŒ“</button>
  </div>
  <div id="chat-container">
    <div id="chat"></div>
  </div>
  <form id="input-form">
    <textarea id="user-input" placeholder="Mensaje" rows="1"></textarea>
    <button type="submit" id="send-button">â¤</button>
  </form>
  <script>
    const apiKey = "TU_API_KEY_AQUI"; // Reemplaza aquÃ­ tu API Key

    const chat = document.getElementById("chat");
    const form = document.getElementById("input-form");
    const input = document.getElementById("user-input");
    const modeToggle = document.getElementById("mode-toggle");
    let presented = false;

    const mensajesFueraDeTema = [
      "aconcagua", "planeta", "capital", "turismo", "deporte", "historia", "geografÃ­a", "montaÃ±a"
    ];

    const respuestasFueraDeTema = `ğŸ¤– Lo siento, solo puedo responder preguntas sobre seguridad alimentaria, BPM o procedimientos internos.`;

    const procedimientosPDF = {
      queso: "Suc Pg 005 Fraccionamiento De Quesos Rev 004.pdf",
      dulce: "Suc Pg 008 Rotulado De Productos Intermedios Rev 000.pdf",
      sanitizante: "G Pg 007 Med Cc Sanitizante Rev 002.pdf"
    };

    const detectarProcedimiento = (texto) => {
      texto = texto.toLowerCase();
      if ((texto.includes("procedimiento") || texto.includes("documento"))) {
        if (texto.includes("queso")) return procedimientosPDF.queso;
        if (texto.includes("dulce")) return procedimientosPDF.dulce;
        if (texto.includes("sanitizante")) return procedimientosPDF.sanitizante;
      }
      return null;
    };

    const agregarMensaje = (remitente, texto, archivo = null) => {
      const mensaje = document.createElement("div");
      mensaje.className = `mensaje ${remitente}`;
      mensaje.innerHTML = texto;
      if (archivo) {
        const link = document.createElement("a");
        link.href = archivo;
        link.textContent = "ğŸ“ Descargar PDF";
        link.download = archivo;
        link.style.display = "block";
        link.style.marginTop = "6px";
        mensaje.appendChild(link);
      }
      chat.appendChild(mensaje);
      chat.scrollTop = chat.scrollHeight;
    };

    const pensar = async (pregunta) => {
      const fileMatch = detectarProcedimiento(pregunta);
      if (fileMatch) {
        agregarMensaje("valeria", `ğŸ“„ AquÃ­ tenÃ©s el documento que necesitÃ¡s:`, fileMatch);
        return;
      }

      if (mensajesFueraDeTema.some(palabra => pregunta.toLowerCase().includes(palabra))) {
        agregarMensaje("valeria", respuestasFueraDeTema);
        return;
      }

      const prompt = `RespondÃ© como Valeria, especialista en seguridad alimentaria. SÃ© clara, pedagÃ³gica, usÃ¡ emoticones si es Ãºtil, y limitate solo a temas como BPM, CAA y procedimientos internos. No respondas temas ajenos a tu especialidad.\n\nUsuario: ${pregunta}\nValeria:`;

      const respuesta = await fetch("https://api.openai.com/v1/chat/completions", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          'Authorization': 'Bearer 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'

        },
        body: JSON.stringify({
          model: "gpt-3.5-turbo",
          messages: [{ role: "user", content: prompt }],
          temperature: 0.7,
        }),
      });

      const datos = await respuesta.json();
      const texto = datos.choices?.[0]?.message?.content || "ğŸ¤” No entendÃ­ del todo. Â¿PodÃ©s reformular o decirme sobre quÃ© procedimiento o tema querÃ©s hablar?";
      agregarMensaje("valeria", texto);
    };

    form.addEventListener("submit", (e) => {
      e.preventDefault();
      const pregunta = input.value.trim();
      if (!pregunta) return;
      agregarMensaje("usuario", pregunta);
      input.value = "";
      pensar(pregunta);
    });

    modeToggle.addEventListener("click", () => {
      document.body.classList.toggle("modo-noche");
    });

    setTimeout(() => {
      if (!presented) {
        agregarMensaje("valeria", "ğŸ‘©ğŸ»â€âš•ï¸ Â¡Hola! Soy Valeria, especialista en seguridad alimentaria. Â¿En quÃ© te puedo ayudar hoy?");
        presented = true;
      }
    }, 5000);
  </script>
</body>
</html>

